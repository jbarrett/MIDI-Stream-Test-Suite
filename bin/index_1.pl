#!/usr/bin/env perl;

# Generate the index of MIDI 1.0 test files
# Mostly generated by find2perl

use v5.40;
use File::Find ();

use FindBin qw($Bin);
use JSON::PP qw/ encode_json /;
my $root = "$Bin/../";

# Set the variable $File::Find::dont_use_nlink if you're using AFS,
# since AFS cheats.

# for the convenience of &wanted calls, including -eval statements:
use vars qw/*name *dir *prune/;
*name   = *File::Find::name;
*dir    = *File::Find::dir;
*prune  = *File::Find::prune;

sub wanted;

my @json_files;

# Traverse desired filesystems
File::Find::find({wanted => \&wanted}, "${root}MIDI_1");

open my $fh, '>', "$root/index_1.json";
print $fh encode_json( \@json_files );

exit;

sub wanted {
    /^.*\.json\z/s
    && warn $name
    && push( @json_files, $name =~ s/$root//r );
}

